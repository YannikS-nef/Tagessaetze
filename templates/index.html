<!doctype html>
<html lang="de">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Tagessatz Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
  </head>
  <body class="bg-light">
    <div class="container py-4">
      <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
          <h1 class="h3 mb-1">Kunden & Tagessatz Übersicht</h1>
          <p class="text-muted mb-0">Vergleich von Tagessätzen, Umsatz und Potenzial zur Anpassung.</p>
        </div>
      </div>

      <div class="row g-3 mb-4">
        <div class="col-md-4">
          <div class="card border-0 shadow-sm"><div class="card-body"><div class="text-muted">Kunden</div><div class="fs-3 fw-bold">{{ totals.customers }}</div></div></div>
        </div>
        <div class="col-md-4">
          <div class="card border-0 shadow-sm"><div class="card-body"><div class="text-muted">Gesamtumsatz</div><div class="fs-3 fw-bold">{{ "%.2f"|format(totals.revenue) }} €</div></div></div>
        </div>
        <div class="col-md-4">
          <div class="card border-0 shadow-sm"><div class="card-body"><div class="text-muted">Ø Tagessatz</div><div class="fs-3 fw-bold">{{ "%.2f"|format(totals.avg_rate) }} €</div></div></div>
        </div>
      </div>

      <div class="row g-4">
        <div class="col-lg-5">
          <div class="card border-0 shadow-sm mb-4">
            <div class="card-header bg-white"><strong>Kunde anlegen</strong></div>
            <div class="card-body">
              <form method="post" action="/customers" class="row g-3">
                <div class="col-12">
                  <label class="form-label">Kundenname</label>
                  <input required class="form-control" name="name" />
                </div>
                <div class="col-md-6">
                  <label class="form-label">Tagessatz (€)</label>
                  <input required type="number" step="0.01" class="form-control" name="daily_rate" />
                </div>
                <div class="col-md-6">
                  <label class="form-label">Umsatz bisher (€)</label>
                  <input type="number" step="0.01" class="form-control" name="revenue" value="0" />
                </div>
                <div class="col-12">
                  <label class="form-label">Kundentyp</label>
                  <select class="form-select" name="customer_type">
                    <option>Hauptkunde</option>
                    <option selected>Nebenkunde</option>
                  </select>
                </div>
                <div class="col-12"><button class="btn btn-primary w-100">Speichern</button></div>
              </form>
            </div>
          </div>

          <div class="card border-0 shadow-sm">
            <div class="card-header bg-white"><strong>Raten-Rechner (Jahresziel)</strong></div>
            <div class="card-body">
              <form method="get" action="/" class="row g-2">
                <input type="hidden" name="optimize" value="1" />
                <div class="col-6"><label class="form-label">Bruttoziel/Jahr (€)</label><input class="form-control" type="number" step="0.01" name="gross_target" value="120000" /></div>
                <div class="col-6"><label class="form-label">Nettoziel/Jahr (€)</label><input class="form-control" type="number" step="0.01" name="net_target" value="0" /></div>
                <div class="col-6"><label class="form-label">Steuern+Kosten (%)</label><input class="form-control" type="number" step="0.1" name="tax_and_cost_factor" value="35" /></div>
                <div class="col-6"><label class="form-label">Urlaubstage</label><input class="form-control" type="number" name="vacation_days" value="30" /></div>
                <div class="col-6"><label class="form-label">Feiertage</label><input class="form-control" type="number" name="holidays" value="10" /></div>
                <div class="col-6"><label class="form-label">Krankheitstage</label><input class="form-control" type="number" name="sick_days" value="5" /></div>
                <div class="col-6"><label class="form-label">Arbeitstage/Woche</label><input class="form-control" type="number" name="workdays_per_week" value="5" /></div>
                <div class="col-6"><label class="form-label">Auslastung (%)</label><input class="form-control" type="number" step="0.1" name="utilization_percent" value="75" /></div>
                <div class="col-12"><label class="form-label">Stunden pro Tag</label><input class="form-control" type="number" step="0.1" name="hours_per_day" value="8" /></div>
                <div class="col-12"><button class="btn btn-outline-primary w-100">Optimale Sätze berechnen</button></div>
              </form>
              {% if optimizer_result %}
              <hr />
              <div class="small text-muted">Benötigter Jahresumsatz</div><div class="fw-bold mb-2">{{ "%.2f"|format(optimizer_result.required_annual_revenue) }} €</div>
              <div class="small text-muted">Abrechenbare Tage</div><div class="fw-bold mb-2">{{ "%.1f"|format(optimizer_result.billable_days) }}</div>
              <div class="small text-muted">Erforderlicher Tagessatz</div><div class="fw-bold mb-2">{{ "%.2f"|format(optimizer_result.required_daily_rate) }} €</div>
              <div class="small text-muted">Erforderlicher Stundensatz</div><div class="fw-bold">{{ "%.2f"|format(optimizer_result.required_hourly_rate) }} €</div>
              {% endif %}
            </div>
          </div>
        </div>

        <div class="col-lg-7">
          <div class="card border-0 shadow-sm">
            <div class="card-header bg-white"><strong>Kundenliste</strong></div>
            <div class="table-responsive">
              <table class="table table-striped mb-0 align-middle">
                <thead>
                  <tr>
                    <th>Kunde</th><th>Typ</th><th>Tagessatz</th><th>Umsatz</th><th>Ampel</th><th></th>
                  </tr>
                </thead>
                <tbody>
                  {% for customer in customers %}
                  <tr>
                    <td>{{ customer.name }}</td>
                    <td><span class="badge bg-{{ 'primary' if customer.customer_type == 'Hauptkunde' else 'secondary' }}">{{ customer.customer_type }}</span></td>
                    <td>{{ "%.2f"|format(customer.daily_rate) }} €</td>
                    <td>{{ "%.2f"|format(customer.revenue) }} €</td>
                    <td><span class="badge bg-{{ customer.ampel_color }}">{{ customer.ampel_label }}</span></td>
                    <td>
                      <form method="post" action="/customers/{{ customer.id }}/delete">
                        <button class="btn btn-sm btn-outline-danger">Löschen</button>
                      </form>
                    </td>
                  </tr>
                  {% else %}
                  <tr><td colspan="6" class="text-center text-muted p-4">Noch keine Kunden erfasst.</td></tr>
                  {% endfor %}
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
    </div>
  </body>
</html>
